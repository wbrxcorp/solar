<html>
<head>
  <meta name="robots" content="noindex">
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular-resource.min.js"></script>
  <script>
  angular.module("CC", ["ngResource"])
  .run(["$rootScope","$resource",  function($scope, $resource) {
    var rate = $resource("https://query.yahooapis.com/v1/public/yql");
    var coins = $resource("coins.json");
    var user = $resource("https://api.nanopool.org/v1/:coin/user/:address");
    var price = $resource("https://api.nanopool.org/v1/:coin/prices");
    $scope.usdjpy = rate.get({q:'select * from yahoo.finance.xchange where pair in ("USDJPY")',format:'json',env:'store://datatables.org/alltableswithkeys'}, function(data) {
      $scope.usdjpy = parseFloat(data.query.results.rate.Rate);
    });
    $scope.coins = coins.get({}, function(data) {
      Object.keys(data).forEach(function(key) {
        if (key[0] == '$') return;
        var value = data[key];
        value.user = user.get({"coin":key,"address":value.address});
        value.price = price.get({"coin":key});
      });
    });
  }]);
  angular.element(document).ready(function() {
    angular.bootstrap(document, ['CC']);
  });  </script>
</head>
<body>
  <div class="container">
    <h1>Miners</h1>
    <table class="table">
      <tr><th>Coin</th><th>Price</th><th>Balance</th><th>Hashrate</th><th># of Workers</th></tr>
      <tr ng-repeat="(key,value) in coins">
        <td><a href="https://{{key}}.nanopool.org/account/{{value.address}}" target="_blank">{{key}}</a></td>
        <td><a href="https://coincheck.com/exchange/tradeview/coincheck/{{key}}jpy" target="_blank">￥{{value.price.data.price_usd * usdjpy|number:0}}</a></td>
        <td>
          ￥{{value.user.data.balance * value.price.data.price_usd * usdjpy|number:0}} / ￥{{value.payout * value.price.data.price_usd * usdjpy|number:0}} <small>({{value.user.data.balance}} / {{value.payout}}{{key}})</small>
          <div class="progress" style="margin-bottom:0;">
            <div class="progress-bar progress-bar-striped" role="progressbar" style="width: {{value.user.data.balance * 100 / value.payout}}%;">
              {{value.user.data.balance * 100 / value.payout | number:1}}%
            </div>
          </div>
        </td>
        <td>{{value.user.data.hashrate}}</td>
        <td>{{value.user.data.workers.length}}</td>
      </tr>
      <tr>
        <td>USD</td><td>￥{{usdjpy|number:2}}</td><td>0</td><td>0</td><td>0</td>
      </tr>
    </table>
    <ul>
      <li><a href="https://coincheck.com/ja/exchange" target="_blank">Coincheck</a></li>
      <li><a href="https://poloniex.com/balances" target="_blank">Poloniex</li>
      <li><a href="https://purse.io/orders" target="_blank">Purse.io</a></li>
    </ul>
  </div>
</body>
</html>
